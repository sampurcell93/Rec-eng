// Generated by CoffeeScript 1.6.3
(function() {
  window.cc = function() {
    var arg, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = arguments.length; _i < _len; _i++) {
      arg = arguments[_i];
      _results.push(console.log(arg));
    }
    return _results;
  };

  $(function() {
    var Post, PostList, PostListItem, Posts, list;
    Post = Backbone.Model.extend({
      parse: function(model) {
        model.start_date = new Date(model.start_date);
        model.end_date = new Date(model.end_date);
        model.description = JSON.parse(model.description).text_out;
        return model;
      }
    });
    Posts = Backbone.Collection.extend({
      start: 0,
      url: function() {
        return '/recommendations/' + this.start;
      },
      model: Post
    });
    PostListItem = Backbone.View.extend({
      template: $("#post-item").html(),
      tagName: 'li',
      render: function() {
        this.$el.html(_.template(this.template, this.model.toJSON()));
        return this;
      },
      ratePost: function(like) {
        var a1, a2, attrs, loc;
        attrs = this.model.toJSON();
        a1 = attrs.activity1;
        a2 = attrs.activity2;
        loc = attrs.location;
        cc(this.model.toJSON());
        return $.ajax({
          url: '/users/' + window.userid + "/" + like,
          data: {
            activities: [a1, a2],
            location: loc
          },
          type: 'PUT',
          success: function(result) {
            return cc(result);
          }
        });
      },
      events: {
        "click .js-like-post": function(e) {
          this.ratePost(true);
          return $(e.currentTarget).addClass("js-unlike-post").removeClass("js-like-post").text("Unlike");
        },
        "click .js-unlike-post": function(e) {
          this.ratePost(false);
          return $(e.currentTarget).addClass("js-like-post").removeClass("js-unlike-post").text("Like");
        }
      }
    });
    PostList = Backbone.View.extend({
      el: 'ul.post-list',
      initialize: function() {
        _.bindAll(this, "addPost", "render");
        this.listenTo(this.collection, "add", this.addPost);
        return this.render();
      },
      addPost: function(post) {
        this.$el.append((new PostListItem({
          model: post
        })).render().el);
        return this;
      },
      render: function() {
        _.each(this.collection.models, this.addPost);
        return this;
      }
    });
    window.allposts = new Posts;
    list = null;
    return allposts.fetch({
      success: function(response) {
        return list = new PostList({
          collection: response
        });
      },
      parse: true
    });
  });

  $(window).scroll(function() {
    if ($(window).scrollTop() + $(window).height() === $(document).height()) {
      allposts.start += 20;
      return allposts.fetch({
        remove: false
      });
    }
  });

}).call(this);
